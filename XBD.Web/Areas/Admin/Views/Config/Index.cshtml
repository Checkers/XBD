@using XBD.Entity;

@{
    ViewBag.Title = "网站配置";
    var m = @ViewData["Config"] as ConfigInfo;
}
<script src="~/Scripts/swift.js"></script>
<style type="text/css">
    .txt {
        position: absolute;
        height: 22px;
        border: 1px solid #cdcdcd;
        left: 10px;
        right: 100px;
    }
</style>
<div class="matter">
    <div class="container">
        <div class="row">
            <div class="col-md-12">

                <div class="widget wgreen">

                    <div class="widget-head">
                        <div class="pull-left"></div>
                        <div class="widget-icons pull-right">
                            <a class="wminimize" href="#"><i class="icon-chevron-up"></i></a>
                            @*<a class="wclose" href="#"><i class="icon-remove"></i></a>*@
                        </div>
                        <div class="clearfix"></div>
                    </div>
                    <div class="widget-content">
                        <div class="padd">
                            <h6>网站配置</h6>
                            <hr>
                            <!-- Form starts.  -->
                            <form class="form-horizontal" id="saveConfig" action="/Admin/Config/AddOrEdit" role="form">
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">所属网站</label>
                                    <div class="col-lg-8">
                                        <select id="webType" name="CodeName" class="form-control">
                                            @foreach (Category item in ViewData["WebType"] as List<Category>)
                                            {
                                                <option value="@item.CodeName">@item.Name</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">网站名称</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" name="SiteName" value="@(m.SiteName ?? "")" type="text" placeholder="请输入公司地址">
                                    </div>
                                </div>
                                <input id="id" type="hidden" name="id" value="@(m.id.ToString()??"")" />
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">地址</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" id="address" name="Address" value="@(m.Address??"")" type="text" placeholder="请输入公司地址">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">联系人</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" id="name" name="UserName" value="@(m.UserName??"")" type="text" placeholder="请输入联系人">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">联系电话</label>
                                    <div class="col-lg-8 overflow:hidden">
                                        <div style="float:left;width:49%">
                                            <input class="form-control" id="tel1" name="UserPhone1" value="@(m.UserPhone1??"")" type="text" placeholder="请输入联系电话1">
                                        </div>
                                        <div style="float:left;margin-left:20px;width:48%">
                                            <input class="form-control" id="tel2" name="UserPhone2" value="@(m.UserPhone2??"")" type="text" placeholder="请输入联系电话2">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">QQ:</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" id="emal" name="QQ" value="@(m.QQ??"")" type="text" placeholder="请输入QQ">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">400电话</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" id="call" name="TelCall" value="@(m.TelCall??"")" type="text" placeholder="请输入400电话">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">邮箱:</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" id="emal" name="Email" value="@(m.Email??"")" type="text" placeholder="请输入邮箱">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">关键词</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" id="phone" name="KeyWord" value="@(m.KeyWord ?? "")" type="text" placeholder="请输入网站关键词">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">版权所有</label>
                                    <div class="col-lg-8">
                                        <input class="form-control" id="phone" name="CopyRight" value="@(m.CopyRight ?? "")" type="text" placeholder="请输入网站版权">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">我们是谁</label>
                                    <div class="col-lg-8">
                                        <textarea class="form-control" id="descript" name="Descript" placeholder="请输入描述信息" rows="3">@(m.Descript ?? "")</textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">关于我们</label>
                                    <div class="col-lg-8">
                                        <textarea class="form-control" id="descript" name="About" placeholder="请输入描述信息" rows="3">@(m.About ?? "")</textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">附加脚本</label>
                                    <div class="col-lg-8">
                                        <textarea class="form-control" id="descript" name="ScriptCode" placeholder="请输入脚本信息" rows="3">@(m.ScriptCode ?? "")</textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-lg-4 control-label">二维码</label>
                                    <div class="col-lg-8">
                                        <img id="QRCode" src="@(m.QRCode ?? "")" width="100" height="100" onerror="javascript:this.src='/Areas/Admin/Content/mac-Bootstrap/img/nopic.png'" style="cursor:pointer;" />
                                        <input type="file" name="hideimg" style="display:none;" />
                                        <input type="hidden" id="hideval" name="QRCode" value="@(m.QRCode ?? "")" />
                                        <input name="isWaterMark" value="false" type="hidden" />
                                    </div>
                                </div>
                                <hr>
                                <div class="form-group">
                                    <div class="col-lg-offset-1 col-lg-9">
                                        <a class="btn btn-primary" onclick="submit()">保存修改</a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="widget-foot">
                        <!-- Footer goes here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">提示</h4>
            </div>
            <div class="modal-body">
                <p id="tipcontent"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">关闭</button>
            </div>
        </div>
    </div>
</div>

<script src="~/Scripts/jquery.form.js"></script>
<script type="text/javascript">
    $(function () {
        $('#QRCode').on("click", function () {
            $('#saveConfig [name=hideimg]').trigger("click");
        });

        $('#saveConfig [name=hideimg]').on("change", function () {
            $("#saveConfig").ajaxSubmit({
                type: "post",
                data: $('#saveConfig').formSerialize(),
                url: "/Admin/UpFile/UpLoadFile",
                success: function (data) {
                    $('#QRCode').attr("src", data.Data);
                    $('#hideval').val(data.Data);
                }
            });
        });
    });

    function submit() {
        $('#saveConfig').go(function (data) {
            $('#tipcontent').text(data.Data);
            return $('#myModal').modal('show');
        });
    }

    var Config = {
        current: window.location.host + window.location.pathname,
        getParam: function (name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]); return null;
        }
    }

    pageInit();
    function pageInit() {
        var t = Config.getParam("webTypeCode");
        if (t != null) $('#webType').val(t);
    }
    $('#webType').on("change", function () {
        var url = "http://" + Config.current + "?webTypeCode=" + $(this).val();
        window.location.href = url;
    });


</script>